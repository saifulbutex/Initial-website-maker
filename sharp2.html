<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dust Dashboard with Half-Circle AQI Meter</title>
<script src="https://cdn.jsdelivr.net/npm/justgage@1.3.5/justgage.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
<style>
body { font-family: Arial; text-align:center; background:#f8f9fa; padding:20px; }
.card { display:inline-block; background:white; padding:20px 30px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin:20px; }
#sensorStatus { width:18px; height:18px; border-radius:50%; display:inline-block; margin-left:10px; vertical-align:middle; }
.refresh-btn { background:#007bff; color:white; border:none; padding:5px 12px; border-radius:6px; cursor:pointer; margin-left:10px; font-size:12px; }
.refresh-btn:hover { background:#0056b3; }
</style>
</head>
<body>

<h2>ğŸŒ«ï¸ Dust Monitoring Dashboard</h2>

<div class="card">
  <h3>
    Current Dust: <span id="currentDust">--</span> Âµg/mÂ³
    <div id="sensorStatus" style="background:red;"></div>
    <button class="refresh-btn" id="refreshDust">Refresh Dust</button>
  </h3>
  <div id="aqMeter" style="width:250px; height:150px; margin:auto;"></div>
</div>

<script>
let dustValues = [];
let timestamps = [];

// ------------------ Gauge ------------------
let aqiGauge = new JustGage({
  id: "aqMeter",
  value: 0,
  min: 0,
  max: 200,
  title: "AQI",
  label: "Âµg/mÂ³",
  levelColors: ["green","yellow","orange","red"],
  gaugeWidthScale: 0.6,
  pointer: true,
  startAnimationTime: 1000,
  startAnimationType: ">",
  counter: true,
  donut: true,
  hideMinMax: true,
  customSectors: [{
    color: "green",
    lo: 0,
    hi: 35
  },{
    color: "yellow",
    lo: 36,
    hi: 75
  },{
    color: "orange",
    lo: 76,
    hi: 150
  },{
    color: "red",
    lo: 151,
    hi: 200
  }]
});

// ------------------ Utils ------------------
function calculateRMS(values){ if(values.length===0) return 0; const sqSum=values.reduce((a,b)=>a+b**2,0); return Math.sqrt(sqSum/values.length).toFixed(2); }
function calculateCV(values){ if(values.length===0) return 0; const mean=values.reduce((a,b)=>a+b,0)/values.length; const stdDev=Math.sqrt(values.map(v=>(v-mean)**2).reduce((a,b)=>a+b)/values.length); return ((stdDev/mean)*100).toFixed(2); }
function getAQIColor(dust){ if(dust<=35) return 'green'; if(dust<=75) return 'yellow'; if(dust<=150) return 'orange'; return 'red'; }

// ------------------ ThingSpeak Fetch ------------------
async function fetchDust(){
  // Replace with ThingSpeak API fetch
  const dust = parseFloat((Math.random()*200).toFixed(1));
  const now = new Date().toLocaleTimeString();
  dustValues.push(dust);
  timestamps.push(now);

  // Update current dust value
  document.getElementById('currentDust').textContent = dust;
  document.getElementById('sensorStatus').style.background = 'green'; // assume connected

  // Update AQI gauge
  aqiGauge.refresh(dust);
}

// ------------------ Refresh Button ------------------
document.getElementById('refreshDust').addEventListener('click', fetchDust);

// ------------------ Initial Load ------------------
window.onload = fetchDust();
</script>

</body>
</html>
